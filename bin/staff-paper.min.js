/*! Staff Paper - v0.3.0 - 2012-11-12
* Copyright (c) 2012 Eric Rubio; Licensed MIT */
var StaffPaper;window.StaffPaper=StaffPaper,function(){StaffPaper=function(e,t,n){n||(n={}),this.options=n,this.options.lineSpacing=parseInt(n.lineSpacing,10)||14,this.options.noteSpacing=parseInt(n.noteSpacing,10)||10,this.options.padding=parseInt(n.padding,10)||34,this.options.interStaffPadding=parseInt(n.interStaffPadding,10)||28,this.container_id=e,this.width=parseInt(t,10),this.height=this.options.lineSpacing*4+this.options.padding*2,this.staves=[],this.ui={staves:[]},this.drawBG=!0,this.paper=new Raphael(this.container_id,this.width,this.height)},StaffPaper.prototype.addStaff=function(e,t){var n=new StaffPaper.Staff(e,t);return n.options=this.options,this.staves.push(n),n},StaffPaper.prototype.staffPathWithYOffset=function(e){var t="";for(var n=0,r=e;n<5;n++,r+=this.options.lineSpacing)t+="M0 "+r.toString()+"L"+this.width+" "+r.toString();return t},StaffPaper.prototype.getYPosForNote=function(e){var t=Math.floor(this.options.lineSpacing*.5);return this.options.padding+t*e.positionIndex},StaffPaper.prototype.draw=function(){if(this.drawBG){this.drawBG=!1;var e=this.options.lineSpacing*4;this.height=e*this.staves.length+this.options.interStaffPadding*(this.staves.length-1)+this.options.padding*2,this.paper.setSize(this.width,this.height),this.ui.bg=this.paper.rect(0,0,this.width,this.height,4).attr({fill:"#efefef",stroke:"none"});var t=this.options.padding;for(var n=0;n<this.staves.length;n++)this.ui.staves.push(this.paper.path(this.staffPathWithYOffset(t)).attr({stroke:"#888","stroke-width":2})),t+=e+this.options.interStaffPadding}var r=Math.floor(this.options.lineSpacing*.5-2),i=Math.floor(r*1.375),s=40;for(var o=0;o<this.staves.length;o++){var u=this.staves[o];for(var a=0;a<u.notes.length;a++){var f=u.notes[a],l=s+a*(i+i+this.options.noteSpacing),c=this.getYPosForNote(f);this.paper.ellipse(l,c,i,r).attr({fill:"#000"}).rotate(-25)}}},StaffPaper.prototype.clear=function(){this.staves=[],this.ui={},this.paper.clear()},StaffPaper.Note=function(e,t,n,r){this.positionIndex=e,this.name=t||"",this.duration=parseInt(n,10)||4,this.octave=r},StaffPaper.Staff=function(e,t){this.clef=e||"",this.notes=[],this.options={};var n=parseInt(t,10)||0;this.clef==="g"?this.octave=4+n:this.clef==="f"&&(this.octave=2+n)},StaffPaper.Staff.prototype.addNote=function(e,t){var n=StaffPaper.getNoteInfo(this,e),r=parseInt(t,10)||4;this.notes.push(new StaffPaper.Note(e,n.name,r,n.octave))},StaffPaper.getNoteInfo=function(e,t){var n="",r=e.octave;if(e.clef==="g"){t<=-4?r=6:t>=-3&&t<=3?r=5:t>=11&&(r=3);switch(t){case-6:n="E";break;case-5:n="D";break;case-4:n="C";break;case-3:n="B";break;case-2:n="A";break;case-1:n="G";break;case 0:n="F";break;case 1:n="E";break;case 2:n="D";break;case 3:n="C";break;case 4:n="B";break;case 5:n="A";break;case 6:n="G";break;case 7:n="F";break;case 8:n="E";break;case 9:n="D";break;case 10:n="C";break;case 11:n="B";break;case 12:n="A"}}else if(e.clef==="f"){t<=-2?r=4:t<=5&&(r=3);switch(t){case-4:n="E";break;case-3:n="D";break;case-2:n="C";break;case-1:n="B";break;case 0:n="A";break;case 1:n="G";break;case 2:n="F";break;case 3:n="E";break;case 4:n="D";break;case 5:n="C";break;case 6:n="B";break;case 7:n="A";break;case 8:n="G";break;case 9:n="F";break;case 10:n="E";break;case 11:n="D";break;case 12:n="C"}}return{name:n,octave:r}}}(StaffPaper);